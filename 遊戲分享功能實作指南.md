# éŠæˆ²åˆ†äº«åŠŸèƒ½å¯¦ä½œæŒ‡å— (å« IG é™æ™‚å‹•æ…‹å„ªåŒ–ç‰ˆ)

## å°ˆæ¡ˆèƒŒæ™¯

é€™æ˜¯ä¸€å€‹åç‚ºã€Œ2026 Happy Yuan Day - åª›ä¾†æ¥åŠ›ã€çš„ç¶²é éŠæˆ²å°ˆæ¡ˆï¼Œä½¿ç”¨ HTML5 Canvasã€ç´” JavaScript é–‹ç™¼ã€‚ç›®å‰éœ€è¦æ–°å¢éŠæˆ²çµæŸå¾Œçš„åˆ†äº«åŠŸèƒ½ï¼Œç‰¹åˆ¥å„ªåŒ– Instagram é™æ™‚å‹•æ…‹åˆ†äº«é«”é©—ã€‚

## ç›®æ¨™åŠŸèƒ½

åœ¨éŠæˆ²çµæŸå¾Œï¼Œè‡ªå‹•ç”ŸæˆåŒ…å«éŠæˆ²æˆç¸¾å’Œ QR Code çš„ç²¾ç¾åœ–å¡ï¼Œæä¾›ä¸‹è¼‰å’Œåˆ†äº«åˆ°ç¤¾ç¾¤åª’é«”ï¼ˆç‰¹åˆ¥æ˜¯ Instagram é™æ™‚å‹•æ…‹ï¼‰çš„åŠŸèƒ½ã€‚

***

## æŠ€è¡“æ–¹æ¡ˆé¸æ“‡

### åœ–å¡ç”Ÿæˆ: ç´” Canvas å¯¦ä½œ

- ä½¿ç”¨ç¾æœ‰çš„ Canvas APIï¼Œç„¡éœ€é¡å¤–å‡½å¼åº«
- ä¿æŒå°ˆæ¡ˆè¼•é‡åŒ–
- èˆ‡ç¾æœ‰éŠæˆ²æ¸²æŸ“æŠ€è¡“ä¸€è‡´


### QR Code ç”Ÿæˆ: qrcode-generator

- è¼•é‡ç´šå‡½å¼åº« (~11KB)
- CDN å¼•å…¥: `https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js`
- ç„¡å…¶ä»–ä¾è³´


### åˆ†äº«æ©Ÿåˆ¶: Web Share API

- ç€è¦½å™¨åŸç”Ÿ APIï¼Œç„¡éœ€å‡½å¼åº«
- **å®Œæ•´æ”¯æ´ Instagram é™æ™‚å‹•æ…‹åˆ†äº«** â­
- æ‰‹æ©Ÿè£ç½®å„ªå…ˆæ”¯æ´ (iOS Safariã€Android Chrome)
- æ¡Œé¢ç‰ˆé™ç´šç‚ºä¸‹è¼‰åŠŸèƒ½


### åœ–å¡å°ºå¯¸ç­–ç•¥

- **é™æ™‚å‹•æ…‹å°ˆç”¨**: 1080x1920 (9:16 ç›´å¼)
- **é€šç”¨æ ¼å¼**: 1080x1080 (1:1 æ–¹å½¢)
- æä¾›ä½¿ç”¨è€…é¸æ“‡åˆ†äº«æ ¼å¼

***

## å¯¦ä½œæ­¥é©Ÿ

### æ­¥é©Ÿ 1: åœ¨ index.html ä¸­å¼•å…¥ QR Code å‡½å¼åº«

åœ¨ `<head>` æˆ– `</body>` å‰åŠ å…¥:

```html
<script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
```


### æ­¥é©Ÿ 2: æ–°å¢åˆ†äº«é¢æ¿ UI åˆ° index.html

åœ¨ç¾æœ‰çš„éŠæˆ²çµæŸç•«é¢(game-over modal)ä¸­åŠ å…¥åˆ†äº«é¸é …å€å¡Š:

```html
<!-- åœ¨éŠæˆ²çµæŸ modal ä¸­åŠ å…¥ -->
<div id="share-section" style="margin-top: 20px;">
    <!-- åœ–å¡æ ¼å¼é¸æ“‡å™¨ -->
    <div id="share-format-selector" style="margin-bottom: 15px;">
        <p style="font-size: 14px; color: #666; margin-bottom: 8px;">é¸æ“‡åˆ†äº«æ ¼å¼:</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button id="formatSquareBtn" class="format-btn active" data-format="square">
                ğŸ“± æ–¹å½¢ (1:1)<br>
                <span style="font-size: 12px;">é©åˆè²¼æ–‡</span>
            </button>
            <button id="formatStoryBtn" class="format-btn" data-format="story">
                ğŸ“± ç›´å¼ (9:16)<br>
                <span style="font-size: 12px;">é©åˆé™å‹•</span>
            </button>
        </div>
    </div>
    
    <!-- åœ–å¡é è¦½å€ -->
    <div id="score-card-preview" style="margin-bottom: 15px;">
        <canvas id="scoreCardCanvas" style="max-width: 100%; max-height: 400px; border: 2px solid #ddd; border-radius: 8px;"></canvas>
    </div>
    
    <!-- æ“ä½œæŒ‰éˆ• -->
    <div id="share-actions" style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
        <button id="downloadScoreBtn" class="share-btn download-btn">
            ğŸ“¥ ä¸‹è¼‰åœ–ç‰‡
        </button>
        <button id="shareScoreBtn" class="share-btn share-btn-primary">
            ğŸ“¤ åˆ†äº«åˆ°é™å‹•
        </button>
    </div>
    
    <!-- æç¤ºæ–‡å­— -->
    <p id="share-tip" style="font-size: 12px; color: #999; margin-top: 10px; text-align: center;">
        é»æ“Šã€Œåˆ†äº«åˆ°é™å‹•ã€å¯ç›´æ¥å‚³é€è‡³ Instagram é™æ™‚å‹•æ…‹
    </p>
</div>
```


### æ­¥é©Ÿ 3: åœ¨ style.css ä¸­åŠ å…¥åˆ†äº«æŒ‰éˆ•æ¨£å¼

```css
/* åˆ†äº«å€å¡Šæ¨£å¼ */
#share-section {
    padding: 20px;
}

/* æ ¼å¼é¸æ“‡æŒ‰éˆ• */
.format-btn {
    padding: 12px 20px;
    font-size: 14px;
    font-weight: bold;
    border: 2px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    background: white;
    color: #666;
    transition: all 0.3s;
    flex: 1;
    min-width: 120px;
}

.format-btn:hover {
    border-color: #667eea;
    color: #667eea;
}

.format-btn.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
}

/* åœ–å¡é è¦½å€ */
#score-card-preview {
    display: flex;
    justify-content: center;
    align-items: center;
    background: #f7fafc;
    padding: 15px;
    border-radius: 8px;
}

#scoreCardCanvas {
    background: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* åˆ†äº«æŒ‰éˆ•æ¨£å¼ */
.share-btn {
    padding: 14px 28px;
    font-size: 16px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    min-width: 140px;
}

.download-btn {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.share-btn-primary {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    color: white;
}

.share-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.share-btn:active {
    transform: translateY(0);
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 480px) {
    .format-btn {
        font-size: 12px;
        padding: 10px 15px;
    }
    
    .share-btn {
        font-size: 14px;
        padding: 12px 20px;
        min-width: 120px;
    }
    
    #share-actions {
        width: 100%;
    }
    
    #share-actions .share-btn {
        flex: 1;
    }
}
```


### æ­¥é©Ÿ 4: åœ¨ game.js ä¸­å¯¦ä½œåœ–å¡ç”ŸæˆåŠŸèƒ½

åœ¨é©ç•¶ä½ç½®åŠ å…¥ä»¥ä¸‹å‡½æ•¸:

```javascript
// å…¨åŸŸè®Šæ•¸å„²å­˜ç•¶å‰é¸æ“‡çš„æ ¼å¼
let currentShareFormat = 'square'; // 'square' æˆ– 'story'

/**
 * ç”Ÿæˆ QR Code çš„ Data URL
 * @param {string} url - è¦ç·¨ç¢¼çš„ç¶²å€
 * @param {number} size - QR Code å¤§å°
 * @returns {string} Data URL
 */
function generateQRCode(url, size = 4) {
    const qr = qrcode(0, 'M'); // 0 = è‡ªå‹•é¸æ“‡æœ€ä½³ç‰ˆæœ¬, 'M' = ä¸­ç­‰éŒ¯èª¤ä¿®æ­£
    qr.addData(url);
    qr.make();
    return qr.createDataURL(size); // size æ˜¯æ¯å€‹æ¨¡çµ„çš„åƒç´ å¤§å°
}

/**
 * ç”Ÿæˆæˆç¸¾åœ–å¡
 * @param {Object} gameStats - éŠæˆ²çµ±è¨ˆè³‡æ–™
 * @param {string} format - åœ–å¡æ ¼å¼ ('square' æˆ– 'story')
 * @returns {Promise<string>} åœ–ç‰‡ Data URL
 */
async function generateScoreCard(gameStats, format = 'square') {
    return new Promise((resolve) => {
        const canvas = document.getElementById('scoreCardCanvas');
        const ctx = canvas.getContext('2d');
        
        // æ ¹æ“šæ ¼å¼è¨­å®š Canvas å°ºå¯¸
        if (format === 'story') {
            // Instagram é™æ™‚å‹•æ…‹æœ€ä½³å°ºå¯¸
            canvas.width = 1080;
            canvas.height = 1920;
        } else {
            // é€šç”¨æ–¹å½¢æ ¼å¼ (é©åˆè²¼æ–‡)
            canvas.width = 1080;
            canvas.height = 1080;
        }
        
        const width = canvas.width;
        const height = canvas.height;
        
        // ç¹ªè£½èƒŒæ™¯æ¼¸å±¤
        const gradient = ctx.createLinearGradient(0, 0, 0, height);
        gradient.addColorStop(0, '#667eea');
        gradient.addColorStop(1, '#764ba2');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, width, height);
        
        // è¨ˆç®—å…§å®¹å€åŸŸ (æ ¹æ“šæ ¼å¼èª¿æ•´)
        const padding = 80;
        const contentWidth = width - (padding * 2);
        const contentHeight = height - (padding * 2);
        
        // ç¹ªè£½ç™½è‰²å…§å®¹å€å¡Š
        ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
        ctx.roundRect(padding, padding, contentWidth, contentHeight, 30);
        ctx.fill();
        
        // è¨ˆç®—å‚ç›´é–“è· (æ ¹æ“šæ ¼å¼èª¿æ•´)
        const isStory = format === 'story';
        const titleY = isStory ? 200 : 180;
        const subtitleY = titleY + 60;
        const dividerY = subtitleY + 40;
        const statsStartY = dividerY + 80;
        const statsSpacing = isStory ? 100 : 90;
        const qrSectionY = isStory ? height - 500 : 740;
        
        // ç¹ªè£½æ¨™é¡Œ
        ctx.fillStyle = '#2d3748';
        ctx.font = 'bold 72px Arial, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('ğŸ® 2026 Happy Yuan Day', width / 2, titleY);
        
        // ç¹ªè£½å‰¯æ¨™é¡Œ
        ctx.font = '36px Arial, sans-serif';
        ctx.fillStyle = '#4a5568';
        ctx.fillText('åª›ä¾†æ¥åŠ› - éŠæˆ²æˆç¸¾', width / 2, subtitleY);
        
        // ç¹ªè£½åˆ†éš”ç·š
        ctx.strokeStyle = '#cbd5e0';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(padding + 100, dividerY);
        ctx.lineTo(width - padding - 100, dividerY);
        ctx.stroke();
        
        // ç¹ªè£½æˆç¸¾è³‡è¨Š
        const stats = [
            { label: 'æœ¬å±€åˆ†æ•¸', value: gameStats.score, emoji: 'â­' },
            { label: 'æ¥åˆ°ç‰©å“', value: gameStats.itemsCaught, emoji: 'ğŸ¯' },
            { label: 'ç­”å°é¡Œæ•¸', value: gameStats.correctAnswers, emoji: 'âœ…' },
        ];
        
        ctx.textAlign = 'left';
        let yPosition = statsStartY;
        
        stats.forEach(stat => {
            const leftMargin = padding + 100;
            const rightMargin = width - padding - 100;
            
            // ç¹ªè£½ emoji
            ctx.font = '48px Arial';
            ctx.fillText(stat.emoji, leftMargin, yPosition);
            
            // ç¹ªè£½æ¨™ç±¤
            ctx.font = 'bold 42px Arial, sans-serif';
            ctx.fillStyle = '#2d3748';
            ctx.fillText(stat.label, leftMargin + 80, yPosition);
            
            // ç¹ªè£½æ•¸å€¼
            ctx.font = 'bold 48px Arial, sans-serif';
            ctx.fillStyle = '#667eea';
            ctx.textAlign = 'right';
            ctx.fillText(String(stat.value), rightMargin, yPosition);
            ctx.textAlign = 'left';
            
            yPosition += statsSpacing;
        });
        
        // ç¹ªè£½ QR Code èªªæ˜
        ctx.textAlign = 'center';
        ctx.font = '32px Arial, sans-serif';
        ctx.fillStyle = '#4a5568';
        ctx.fillText('æƒæ QR Code é–‹å§‹æŒ‘æˆ°', width / 2, qrSectionY);
        
        // ç”Ÿæˆä¸¦ç¹ªè£½ QR Code
        const gameURL = window.location.href; // ä½¿ç”¨ç•¶å‰éŠæˆ²ç¶²å€
        const qrDataURL = generateQRCode(gameURL, 6);
        
        const qrImage = new Image();
        qrImage.onload = () => {
            // QR Code å°ºå¯¸å’Œä½ç½®
            const qrSize = isStory ? 250 : 220;
            const qrX = (width - qrSize) / 2;
            const qrY = qrSectionY + 30;
            
            // ç¹ªè£½ QR Code èƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(qrX - 10, qrY - 10, qrSize + 20, qrSize + 20);
            
            // ç¹ªè£½ QR Code
            ctx.drawImage(qrImage, qrX, qrY, qrSize, qrSize);
            
            // å¦‚æœæ˜¯é™å‹•æ ¼å¼ï¼ŒåŠ å…¥åº•éƒ¨æç¤º
            if (isStory) {
                ctx.font = 'bold 28px Arial, sans-serif';
                ctx.fillStyle = '#667eea';
                ctx.fillText('ğŸ‘† ç«‹å³æŒ‘æˆ°', width / 2, qrY + qrSize + 60);
            }
            
            // è½‰æ›æˆ Data URL
            const imageDataURL = canvas.toDataURL('image/png', 0.95);
            resolve(imageDataURL);
        };
        qrImage.src = qrDataURL;
    });
}

/**
 * åˆ‡æ›åˆ†äº«æ ¼å¼ä¸¦é‡æ–°ç”Ÿæˆåœ–å¡
 */
async function switchShareFormat(format) {
    currentShareFormat = format;
    
    // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
    document.querySelectorAll('.format-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-format="${format}"]`).classList.add('active');
    
    // æ›´æ–°æç¤ºæ–‡å­—
    const tipText = format === 'story' 
        ? 'âœ¨ å·²é¸æ“‡é™æ™‚å‹•æ…‹æ ¼å¼ (9:16)ï¼Œæœ€é©åˆ IG é™å‹•åˆ†äº«'
        : 'âœ¨ å·²é¸æ“‡æ–¹å½¢æ ¼å¼ (1:1)ï¼Œé©åˆæ‰€æœ‰å¹³å°';
    document.getElementById('share-tip').textContent = tipText;
    
    // é‡æ–°ç”Ÿæˆåœ–å¡
    const gameStats = window.currentGameStats; // å¾å…¨åŸŸè®Šæ•¸å–å¾—
    const newImageURL = await generateScoreCard(gameStats, format);
    
    // æ›´æ–°å…¨åŸŸè®Šæ•¸
    window.currentScoreCardURL = newImageURL;
}
```


### æ­¥é©Ÿ 5: å¯¦ä½œä¸‹è¼‰åŠŸèƒ½

```javascript
/**
 * ä¸‹è¼‰åœ–ç‰‡
 * @param {string} dataURL - åœ–ç‰‡ Data URL
 */
function downloadImage(dataURL) {
    const formatSuffix = currentShareFormat === 'story' ? 'story' : 'square';
    const filename = `yuan-game-score-${formatSuffix}-${Date.now()}.png`;
    
    const link = document.createElement('a');
    link.download = filename;
    link.href = dataURL;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
```


### æ­¥é©Ÿ 6: å¯¦ä½œ Web Share API åˆ†äº«åŠŸèƒ½ (å„ªåŒ– IG é™å‹•)

```javascript
/**
 * åˆ†äº«åœ–ç‰‡åˆ°ç¤¾ç¾¤åª’é«” (å„ªåŒ– Instagram é™æ™‚å‹•æ…‹é«”é©—)
 * @param {string} dataURL - åœ–ç‰‡ Data URL
 * @param {Object} gameStats - éŠæˆ²çµ±è¨ˆè³‡æ–™
 */
async function shareImage(dataURL, gameStats) {
    try {
        // å°‡ Data URL è½‰æ›æˆ Blob
        const response = await fetch(dataURL);
        const blob = await response.blob();
        
        // æ ¹æ“šæ ¼å¼è¨­å®šæª”æ¡ˆåç¨±
        const formatSuffix = currentShareFormat === 'story' ? 'story' : 'square';
        const filename = `yuan-game-${formatSuffix}.png`;
        const file = new File([blob], filename, { type: 'image/png' });
        
        // å®¢è£½åŒ–åˆ†äº«æ–‡å­—
        const shareTitle = '2026 Happy Yuan Day - åª›ä¾†æ¥åŠ›';
        const shareText = currentShareFormat === 'story'
            ? `æˆ‘åœ¨ã€Œåª›ä¾†æ¥åŠ›ã€å¾—åˆ° ${gameStats.score} åˆ†ï¼ğŸ®\nå¿«ä¾†æŒ‘æˆ°çœ‹çœ‹ä½ èƒ½å¾—å¹¾åˆ†ï¼`
            : `æˆ‘çš„éŠæˆ²æˆç¸¾ï¼š${gameStats.score} åˆ† ğŸ¯\nä¸€èµ·ä¾†ã€Œåª›ä¾†æ¥åŠ›ã€ç©éŠæˆ²ï¼`;
        
        // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Web Share API
        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
            await navigator.share({
                title: shareTitle,
                text: shareText,
                files: [file]
            });
            
            console.log('âœ… åˆ†äº«æˆåŠŸï¼');
            
            // å¯é¸ï¼šè¿½è¹¤åˆ†äº«äº‹ä»¶
            // trackShareEvent('success', currentShareFormat);
            
        } else {
            // é™ç´šæ–¹æ¡ˆï¼šç›´æ¥ä¸‹è¼‰ä¸¦é¡¯ç¤ºæç¤º
            console.log('âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´ Web Share APIï¼Œä½¿ç”¨ä¸‹è¼‰æ–¹æ¡ˆ');
            downloadImage(dataURL);
            showShareTip();
        }
        
    } catch (error) {
        // è™•ç†éŒ¯èª¤
        if (error.name === 'AbortError') {
            // ä½¿ç”¨è€…å–æ¶ˆåˆ†äº«ï¼Œä¸éœ€é¡¯ç¤ºéŒ¯èª¤
            console.log('â„¹ï¸ ä½¿ç”¨è€…å–æ¶ˆåˆ†äº«');
        } else {
            console.error('âŒ åˆ†äº«å¤±æ•—:', error);
            // ç™¼ç”ŸéŒ¯èª¤æ™‚é™ç´šç‚ºä¸‹è¼‰
            downloadImage(dataURL);
            showShareTip();
        }
    }
}

/**
 * é¡¯ç¤ºæ‰‹å‹•åˆ†äº«æç¤º (ç•¶ Web Share API ä¸å¯ç”¨æ™‚)
 */
function showShareTip() {
    const tipMessage = currentShareFormat === 'story'
        ? 'âœ¨ åœ–ç‰‡å·²ä¸‹è¼‰ï¼\n\nè«‹è‡³ç›¸ç°¿é¸æ“‡åœ–ç‰‡ï¼Œç„¶å¾Œ:\n1. é–‹å•Ÿ Instagram\n2. é»é¸å·¦ä¸Šè§’ã€Œ+ã€å»ºç«‹é™æ™‚å‹•æ…‹\n3. é¸æ“‡å‰›ä¸‹è¼‰çš„åœ–ç‰‡\n4. ç›´æ¥åˆ†äº«åˆ°é™å‹•ï¼'
        : 'âœ¨ åœ–ç‰‡å·²ä¸‹è¼‰ï¼\n\næ‚¨å¯ä»¥:\n1. åˆ†äº«åˆ° Instagram è²¼æ–‡\n2. å‚³é€çµ¦æœ‹å‹\n3. ç™¼å¸ƒåˆ°å…¶ä»–ç¤¾ç¾¤å¹³å°';
    
    alert(tipMessage);
}
```


### æ­¥é©Ÿ 7: æ•´åˆåˆ°éŠæˆ²çµæŸæµç¨‹

åœ¨éŠæˆ²çµæŸæ™‚èª¿ç”¨åˆ†äº«åŠŸèƒ½ï¼Œæ‰¾åˆ°ç¾æœ‰çš„éŠæˆ²çµæŸè™•ç†å‡½æ•¸ä¸¦åŠ å…¥:

```javascript
// åœ¨éŠæˆ²çµæŸæ™‚ç”Ÿæˆåœ–å¡
async function onGameOver() {
    // ... ç¾æœ‰çš„éŠæˆ²çµæŸé‚è¼¯ ...
    
    // æ”¶é›†éŠæˆ²çµ±è¨ˆè³‡æ–™
    const gameStats = {
        score: currentScore,
        itemsCaught: positiveItemsCount,
        correctAnswers: correctAnswersCount,
        maxCombo: maxComboCount || 0 // å¦‚æœæœ‰é€£æ“Šç³»çµ±çš„è©±
    };
    
    // å„²å­˜åˆ°å…¨åŸŸè®Šæ•¸ä¾›å¾ŒçºŒä½¿ç”¨
    window.currentGameStats = gameStats;
    
    // ç”Ÿæˆé è¨­æ ¼å¼çš„æˆç¸¾åœ–å¡ (æ–¹å½¢)
    currentShareFormat = 'square';
    const scoreCardURL = await generateScoreCard(gameStats, currentShareFormat);
    window.currentScoreCardURL = scoreCardURL;
    
    // é¡¯ç¤ºåˆ†äº«å€å¡Š
    document.getElementById('share-section').style.display = 'block';
    
    // ç¶å®šæ ¼å¼åˆ‡æ›æŒ‰éˆ•äº‹ä»¶
    document.getElementById('formatSquareBtn').onclick = () => {
        switchShareFormat('square');
    };
    
    document.getElementById('formatStoryBtn').onclick = () => {
        switchShareFormat('story');
    };
    
    // ç¶å®šä¸‹è¼‰æŒ‰éˆ•äº‹ä»¶
    document.getElementById('downloadScoreBtn').onclick = () => {
        downloadImage(window.currentScoreCardURL);
    };
    
    // ç¶å®šåˆ†äº«æŒ‰éˆ•äº‹ä»¶
    document.getElementById('shareScoreBtn').onclick = () => {
        shareImage(window.currentScoreCardURL, gameStats);
    };
}
```


### æ­¥é©Ÿ 8: Canvas roundRect ç›¸å®¹æ€§è™•ç†

æŸäº›ç€è¦½å™¨å¯èƒ½ä¸æ”¯æ´ `roundRect`ï¼Œéœ€åŠ å…¥ polyfill:

```javascript
// åœ¨ game.js é–‹é ­åŠ å…¥
if (!CanvasRenderingContext2D.prototype.roundRect) {
    CanvasRenderingContext2D.prototype.roundRect = function(x, y, width, height, radius) {
        this.beginPath();
        this.moveTo(x + radius, y);
        this.lineTo(x + width - radius, y);
        this.quadraticCurveTo(x + width, y, x + width, y + radius);
        this.lineTo(x + width, y + height - radius);
        this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        this.lineTo(x + radius, y + height);
        this.quadraticCurveTo(x, y + height, x, y + height - radius);
        this.lineTo(x, y + radius);
        this.quadraticCurveTo(x, y, x + radius, y);
        this.closePath();
    };
}
```


***

## Instagram é™æ™‚å‹•æ…‹åˆ†äº«æµç¨‹

### ä½¿ç”¨è€…é«”é©—æµç¨‹

```
éŠæˆ²çµæŸ
    â†“
é¡¯ç¤ºæˆç¸¾åœ–å¡ (é è¨­æ–¹å½¢)
    â†“
ä½¿ç”¨è€…é»é¸ã€ŒğŸ“± ç›´å¼ (9:16) é©åˆé™å‹•ã€
    â†“
åœ–å¡è‡ªå‹•é‡æ–°ç”Ÿæˆç‚º 1080x1920 å°ºå¯¸
    â†“
ä½¿ç”¨è€…é»æ“Šã€ŒğŸ“¤ åˆ†äº«åˆ°é™å‹•ã€
    â†“
[æ‰‹æ©Ÿè£ç½®] å½ˆå‡ºç³»çµ±åˆ†äº«é¸å–®
    â†“
ä½¿ç”¨è€…é¸æ“‡ Instagram
    â†“
Instagram é–‹å•Ÿï¼Œé¡¯ç¤ºä¸‰å€‹é¸é …ï¼š
  - âœ¨ åˆ†äº«è‡³é™æ™‚å‹•æ…‹ â† ä½¿ç”¨è€…é¸é€™å€‹
  - ğŸ“¸ æ–°å¢è‡³è²¼æ–‡
  - ğŸ’¬ å‚³é€è¨Šæ¯
    â†“
åœ–ç‰‡è‡ªå‹•è²¼å…¥é™å‹•ç·¨è¼¯å™¨
(ä½¿ç”¨è€…å¯åŠ è²¼åœ–ã€æ–‡å­—ã€æ¨™ç±¤ç­‰)
    â†“
ç™¼å¸ƒé™æ™‚å‹•æ…‹ âœ…
```


### æ¡Œé¢ç‰ˆé™ç´šæµç¨‹

```
éŠæˆ²çµæŸ
    â†“
ä½¿ç”¨è€…é»æ“Šã€ŒğŸ“¤ åˆ†äº«åˆ°é™å‹•ã€
    â†“
[æ¡Œé¢ç€è¦½å™¨] åµæ¸¬ä¸æ”¯æ´ Web Share API
    â†“
è‡ªå‹•ä¸‹è¼‰åœ–ç‰‡
    â†“
é¡¯ç¤ºæç¤ºè¦–çª—ï¼š
"åœ–ç‰‡å·²ä¸‹è¼‰ï¼è«‹è‡³ç›¸ç°¿é¸æ“‡åœ–ç‰‡ï¼Œ
ç„¶å¾Œé–‹å•Ÿ Instagram å»ºç«‹é™æ™‚å‹•æ…‹..."
    â†“
ä½¿ç”¨è€…æ‰‹å‹•ä¸Šå‚³åˆ° IG
```


***

## æ¸¬è©¦æª¢æŸ¥æ¸…å–®

å®Œæˆå¯¦ä½œå¾Œï¼Œè«‹æ¸¬è©¦ä»¥ä¸‹é …ç›®:

### åŸºç¤åŠŸèƒ½æ¸¬è©¦

- [ ] QR Code å‡½å¼åº«æ­£ç¢ºè¼‰å…¥
- [ ] éŠæˆ²çµæŸå¾Œè‡ªå‹•ç”Ÿæˆåœ–å¡
- [ ] åœ–å¡å…§å®¹æ­£ç¢ºé¡¯ç¤º(åˆ†æ•¸ã€çµ±è¨ˆã€QR Code)
- [ ] QR Code æƒæå¾Œå°å‘æ­£ç¢ºç¶²å€


### æ ¼å¼åˆ‡æ›æ¸¬è©¦

- [ ] é»æ“Šã€Œæ–¹å½¢ã€æŒ‰éˆ•ç”Ÿæˆ 1080x1080 åœ–å¡
- [ ] é»æ“Šã€Œç›´å¼ã€æŒ‰éˆ•ç”Ÿæˆ 1080x1920 åœ–å¡
- [ ] æ ¼å¼åˆ‡æ›æ™‚æŒ‰éˆ•ç‹€æ…‹æ­£ç¢ºæ›´æ–°
- [ ] åœ–å¡å…§å®¹åœ¨å…©ç¨®æ ¼å¼ä¸‹éƒ½æ­£å¸¸é¡¯ç¤º
- [ ] æç¤ºæ–‡å­—éš¨æ ¼å¼åˆ‡æ›è€Œæ›´æ–°


### ä¸‹è¼‰åŠŸèƒ½æ¸¬è©¦

- [ ] é»æ“Šä¸‹è¼‰æŒ‰éˆ•æˆåŠŸä¸‹è¼‰åœ–ç‰‡
- [ ] æª”æ¡ˆåç¨±åŒ…å«æ ¼å¼æ¨™è¨˜ (square/story)
- [ ] ä¸‹è¼‰çš„åœ–ç‰‡å°ºå¯¸æ­£ç¢º
- [ ] åœ–ç‰‡å“è³ªæ¸…æ™°ç„¡å£“ç¸®å¤±çœŸ


### åˆ†äº«åŠŸèƒ½æ¸¬è©¦ (æ‰‹æ©Ÿ)

- [ ] **iPhone (Safari)**
    - [ ] é»æ“Šåˆ†äº«å½ˆå‡ºç³»çµ±åˆ†äº«é¸å–®
    - [ ] Instagram å‡ºç¾åœ¨åˆ†äº«é¸å–®ä¸­
    - [ ] é¸æ“‡ IG å¾ŒæˆåŠŸé–‹å•Ÿ App
    - [ ] å¯é¸æ“‡ã€Œåˆ†äº«è‡³é™æ™‚å‹•æ…‹ã€
    - [ ] åœ–ç‰‡æ­£ç¢ºè²¼å…¥é™å‹•ç·¨è¼¯å™¨
    - [ ] ç›´å¼åœ–ç‰‡åœ¨é™å‹•ä¸­æ»¿ç‰ˆé¡¯ç¤º
- [ ] **Android (Chrome)**
    - [ ] é»æ“Šåˆ†äº«å½ˆå‡ºç³»çµ±åˆ†äº«é¸å–®
    - [ ] Instagram å‡ºç¾åœ¨åˆ†äº«é¸å–®ä¸­
    - [ ] é¸æ“‡ IG å¾ŒæˆåŠŸé–‹å•Ÿ App
    - [ ] å¯é¸æ“‡ã€Œåˆ†äº«è‡³é™æ™‚å‹•æ…‹ã€
    - [ ] åœ–ç‰‡æ­£ç¢ºè²¼å…¥é™å‹•ç·¨è¼¯å™¨


### é™ç´šæ–¹æ¡ˆæ¸¬è©¦ (æ¡Œé¢)

- [ ] æ¡Œé¢ç€è¦½å™¨é»æ“Šåˆ†äº«è‡ªå‹•ä¸‹è¼‰åœ–ç‰‡
- [ ] é¡¯ç¤ºæ‰‹å‹•ä¸Šå‚³æç¤ºè¨Šæ¯
- [ ] æç¤ºè¨Šæ¯å…§å®¹æ¸…æ¥šæ˜“æ‡‚


### è¦–è¦ºèˆ‡ UX æ¸¬è©¦

- [ ] æŒ‰éˆ•æ¨£å¼ç¾è§€ä¸”æ˜“è¾¨è­˜
- [ ] hover æ•ˆæœæµæš¢
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆåœ¨å°è¢å¹•ä¸Šæ­£å¸¸
- [ ] åœ–å¡é è¦½æ¸…æ™°å¯è¦‹
- [ ] æ–‡å­—å¤§å°é©ä¸­æ˜“è®€


### æ•ˆèƒ½æ¸¬è©¦

- [ ] åœ–å¡ç”Ÿæˆé€Ÿåº¦æµæš¢ (< 1 ç§’)
- [ ] æ ¼å¼åˆ‡æ›å³æ™‚åæ‡‰
- [ ] ä¸å½±éŸ¿éŠæˆ²æ•´é«”æ•ˆèƒ½

***

## æ³¨æ„äº‹é …

### é—œéµè¦é»

1. **éŠæˆ²ç¶²å€**: ç¢ºä¿ `window.location.href` æ˜¯æ­£ç¢ºçš„ç”Ÿç”¢ç¶²å€
2. **åœ–ç‰‡å°ºå¯¸**:
    - é™å‹•æ ¼å¼å¿…é ˆæ˜¯ 1080x1920 æ‰èƒ½åœ¨ IG ä¸Šæ»¿ç‰ˆé¡¯ç¤º
    - æ–¹å½¢æ ¼å¼ 1080x1080 é©åˆè²¼æ–‡å’Œå…¶ä»–å¹³å°
3. **æª”æ¡ˆå¤§å°**: Canvas è½‰ PNG å¯èƒ½è¼ƒå¤§ï¼Œå¯èª¿æ•´ `toDataURL` çš„å“è³ªåƒæ•¸
4. **Web Share API**:
    - å¿…é ˆç”±ä½¿ç”¨è€…äº’å‹•è§¸ç™¼ï¼ˆé»æ“ŠæŒ‰éˆ•ï¼‰
    - ç„¡æ³•è‡ªå‹•åˆ†äº«æˆ–åœ¨é é¢è¼‰å…¥æ™‚è§¸ç™¼
5. **Instagram é™åˆ¶**:
    - Web Share API å¯å‚³é€åœ–ç‰‡åˆ° IG
    - ä½† IG ä¸æ”¯æ´é€éç¶²é ç›´æ¥ç™¼å¸ƒï¼ˆéœ€ä½¿ç”¨ Appï¼‰
6. **éš±ç§æ¬Š**: åˆ†äº«æ™‚æœƒé¡¯ç¤ºæª”æ¡ˆåç¨±ï¼Œé¿å…åŒ…å«æ•æ„Ÿè³‡è¨Š

### ç€è¦½å™¨ç›¸å®¹æ€§

- âœ… **iOS Safari 12+**: å®Œæ•´æ”¯æ´ Web Share API + æª”æ¡ˆåˆ†äº«
- âœ… **Android Chrome 75+**: å®Œæ•´æ”¯æ´
- âš ï¸ **æ¡Œé¢ç‰ˆ Chrome/Edge**: éƒ¨åˆ†æ”¯æ´ï¼Œéœ€é™ç´šè™•ç†
- âŒ **Firefox æ¡Œé¢ç‰ˆ**: ä¸æ”¯æ´ï¼Œè‡ªå‹•é™ç´šç‚ºä¸‹è¼‰


### æ•ˆèƒ½å„ªåŒ–å»ºè­°

```javascript
// å¦‚æœåœ–ç‰‡æª”æ¡ˆå¤ªå¤§ï¼Œå¯èª¿æ•´å“è³ª
canvas.toDataURL('image/png', 0.9); // 90% å“è³ª

// æˆ–æ”¹ç”¨ JPEG æ ¼å¼ï¼ˆä½†æœƒå¤±å»é€æ˜åº¦ï¼‰
canvas.toDataURL('image/jpeg', 0.85); // 85% å“è³ªï¼Œæª”æ¡ˆæ›´å°
```


***

## å¾ŒçºŒå„ªåŒ–å»ºè­°

å¯¦ä½œå®Œæˆä¸¦æ¸¬è©¦é€šéå¾Œï¼Œå¯è€ƒæ…®ä»¥ä¸‹é€²éšåŠŸèƒ½:

### çŸ­æœŸå„ªåŒ–

1. **åœ–å¡æ¨£å¼å®¢è£½åŒ–**
    - æä¾› 2-3 ç¨®é…è‰²ä¸»é¡Œè®“ä½¿ç”¨è€…é¸æ“‡
    - åŠ å…¥æ›´å¤šè£é£¾å…ƒç´ ï¼ˆæ˜Ÿæ˜Ÿã€æ„›å¿ƒç­‰ï¼‰
2. **åˆ†äº«çµ±è¨ˆè¿½è¹¤**

```javascript
// è¿½è¹¤åˆ†äº«è¡Œç‚º
function trackShareEvent(action, format) {
    // æ•´åˆ Google Analytics æˆ– Firebase Analytics
    gtag('event', 'share', {
        'event_category': 'game',
        'event_label': format,
        'value': action
    });
}
```

3. **ç¤¾ç¾¤å¹³å°ç›´é€£**

```javascript
// é‡å°ä¸æ”¯æ´ Web Share API çš„å¹³å°æä¾›ç›´é€£
const twitterURL = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${gameURL}`;
const facebookURL = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(gameURL)}`;
```


### ä¸­æœŸå„ªåŒ–

4. **å‹•æ…‹åœ–å¡ (GIF/Video)**
    - ä½¿ç”¨ Canvas éŒ„è£½å‹•ç•«
    - ç”Ÿæˆç°¡çŸ­çš„æˆç¸¾å‹•ç•« GIF
5. **å¥½å‹å°æˆ°çµæœæ¯”è¼ƒ**
    - é¡¯ç¤ºã€Œæˆ‘çš„åˆ†æ•¸ vs å¥½å‹å¹³å‡ã€
    - åŠ å…¥æ’è¡Œæ¦œè³‡è¨Š
6. **å€‹äººåŒ–æ–‡å­—**
    - è®“ç©å®¶åœ¨åœ–å¡ä¸ŠåŠ å…¥è‡ªè¨‚è¨Šæ¯
    - é è¨­ç”Ÿæˆæ¿€å‹µæ€§æ–‡å­—ï¼ˆå¦‚ã€Œæˆ‘è¶…è¶Šäº† 85% çš„ç©å®¶ï¼ã€ï¼‰

### é•·æœŸå„ªåŒ–

7. **Instagram API æ•´åˆ**
    - æ¢ç´¢ Instagram Graph API
    - å¯¦ç¾æ›´æ·±åº¦çš„æ•´åˆï¼ˆéœ€å•†æ¥­å¸³è™Ÿï¼‰
8. **é™å‹•æ¨¡æ¿åº«**
    - æä¾›å¤šç¨®é™å‹•é¢¨æ ¼æ¨¡æ¿
    - å­£ç¯€æ€§/ç¯€æ—¥ç‰¹åˆ¥æ¬¾å¼
9. **AR æ¿¾é¡æ•´åˆ**
    - é–‹ç™¼å°ˆå±¬ Instagram AR æ¿¾é¡
    - åœ¨é™å‹•ä¸­å¯ä½¿ç”¨éŠæˆ²ä¸»é¡Œæ¿¾é¡

***

## å®Œæ•´ç¨‹å¼ç¢¼ç¯„ä¾‹æ‘˜è¦

### æœ€å°å¯è¡Œç‰ˆæœ¬ (MVP)

```javascript
// 1. å¼•å…¥ QR Code CDN
<script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>

// 2. ç”Ÿæˆåœ–å¡
const imageURL = await generateScoreCard(gameStats, 'story');

// 3. åˆ†äº«
await shareImage(imageURL, gameStats);
```


### æ¨è–¦æ•´åˆæ–¹å¼

å°‡åˆ†äº«åŠŸèƒ½å°è£æˆæ¨¡çµ„ï¼Œä¿æŒç¨‹å¼ç¢¼æ•´æ½”ï¼š

```javascript
// share-module.js
const ShareModule = {
    currentFormat: 'square',
    currentImageURL: null,
    
    async init(gameStats) {
        this.gameStats = gameStats;
        await this.generateCard();
        this.bindEvents();
    },
    
    async generateCard() {
        this.currentImageURL = await generateScoreCard(
            this.gameStats, 
            this.currentFormat
        );
    },
    
    bindEvents() {
        // ç¶å®šæ‰€æœ‰äº‹ä»¶è™•ç†
    },
    
    async share() {
        await shareImage(this.currentImageURL, this.gameStats);
    }
};

// ä½¿ç”¨
await ShareModule.init(gameStats);
```


***

## ç–‘é›£æ’è§£

### å¸¸è¦‹å•é¡Œ

**Q: ç‚ºä»€éº¼æ¡Œé¢ç‰ˆç„¡æ³•åˆ†äº«åˆ° Instagramï¼Ÿ**
A: æ¡Œé¢ç‰ˆ Instagram ä¸æ”¯æ´ç›´æ¥ç™¼å¸ƒåŠŸèƒ½ï¼ŒWeb Share API ä¹Ÿæœ‰é™åˆ¶ã€‚å»ºè­°ä½¿ç”¨ä¸‹è¼‰åŠŸèƒ½ï¼Œä¸¦æç¤ºä½¿ç”¨è€…åœ¨æ‰‹æ©Ÿä¸Šæ“ä½œã€‚

**Q: QR Code æƒæå¤±æ•—æ€éº¼è¾¦ï¼Ÿ**
A: æª¢æŸ¥ QR Code çš„ size åƒæ•¸ï¼Œå»ºè­°è¨­ç‚º 6 ä»¥ä¸Šã€‚ç¢ºä¿ QR Code å°ºå¯¸è‡³å°‘ 200x200 åƒç´ ã€‚

**Q: åœ–å¡ç”Ÿæˆé€Ÿåº¦å¾ˆæ…¢ï¼Ÿ**
A: æ¸›å°‘ Canvas ç¹ªè£½è¤‡é›œåº¦ï¼Œæˆ–ä½¿ç”¨ `requestAnimationFrame` åˆ†æ‰¹ç¹ªè£½ã€‚

**Q: åˆ†äº«å¾Œåœ–ç‰‡æ¨¡ç³Šï¼Ÿ**
A: æé«˜ Canvas å°ºå¯¸æˆ–èª¿æ•´ `toDataURL` å“è³ªåƒæ•¸ã€‚

**Q: ä½¿ç”¨è€…å–æ¶ˆåˆ†äº«å¾Œæ²’æœ‰åæ‡‰ï¼Ÿ**
A: é€™æ˜¯æ­£å¸¸çš„ï¼Œ`AbortError` è¡¨ç¤ºä½¿ç”¨è€…ä¸»å‹•å–æ¶ˆï¼Œä¸éœ€é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ã€‚

***

## ç¸½çµ

é€™ä»½å¯¦ä½œæŒ‡å—å®Œæ•´æ¶µè“‹äº†å¾åŸºç¤åŠŸèƒ½åˆ° Instagram é™æ™‚å‹•æ…‹å„ªåŒ–çš„æ‰€æœ‰æ­¥é©Ÿã€‚é‡é»ç‰¹è‰²ï¼š

âœ… **è¼•é‡åŒ–**: åªéœ€ä¸€å€‹ 11KB çš„ QR Code å‡½å¼åº«
âœ… **åŸç”Ÿæ”¯æ´**: ä½¿ç”¨ Web Share APIï¼Œç„¡éœ€ç¬¬ä¸‰æ–¹åˆ†äº« SDK
âœ… **å„ªåŒ–é«”é©—**: å°ˆç‚º IG é™å‹•è¨­è¨ˆçš„ 9:16 ç›´å¼åœ–å¡
âœ… **å®Œæ•´é™ç´š**: æ¡Œé¢ç‰ˆå’Œä¸æ”¯æ´çš„ç€è¦½å™¨è‡ªå‹•é™ç´š
âœ… **ä½¿ç”¨è€…å‹å–„**: ä¸€éµåˆ†äº«åˆ°é™æ™‚å‹•æ…‹

ä¾ç…§æœ¬æŒ‡å—å¯¦ä½œï¼Œç©å®¶å°‡èƒ½å¤ æµæš¢åœ°å°‡éŠæˆ²æˆç¸¾åˆ†äº«åˆ° Instagram é™æ™‚å‹•æ…‹ï¼Œå¤§å¹…æå‡éŠæˆ²çš„å‚³æ’­åŠ›å’Œç¤¾ç¾¤äº’å‹•æ€§ï¼ğŸ‰

